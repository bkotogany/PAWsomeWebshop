#!/usr/bin/env php
<?php
// create_product.php <name> <price> <stock> <sku> <brand> <model> <category> [--description="Description"] [--attr="color=red,size=35"]
use Webshop\Model\Product;
use Webshop\Model\ProductAttribute;
use Webshop\Model\Category;

require_once "vendor/autoload.php";
require __DIR__ . '/../src/Bootstrap.php';

$newProductName = $argv[1];
if ($newProductName != '') {
    $product = new Product();
    $product->setName($newProductName);
    
    // Alapértelmezett értékek
    $product->setPrice(0);
    $product->setStock(0);
    
    // Paraméterek feldolgozása
    for ($i = 2; $i < count($argv); $i++) {
        $arg = $argv[$i];
        if (strpos($arg, '--') === 0) {
            $parts = explode('=', substr($arg, 2));
            if (count($parts) === 2) {
                $key = $parts[0];
                $value = $parts[1];
                
                switch ($key) {
                    case 'price':
                        $product->setPrice((float)$value);
                        break;
                    case 'stock':
                        $product->setStock((int)$value);
                        break;
                    case 'sku':
                        $product->setSku($value);
                        break;
                    case 'brand':
                        $product->setBrand($value);
                        break;
                    case 'model':
                        $product->setModel($value);
                        break;
                    case 'attr':
                        $attributes = explode(',', $value);
                        foreach ($attributes as $attr) {
                            list($name, $val) = explode('=', $attr);
                            $product->setAttribute($name, $val);
                        }
                        break;
                }
            }
        }
    }
    
    $entityManager->persist($product);
    $entityManager->flush();

echo "Termék létrehozva: {$name} (SKU: {$sku})\n";
